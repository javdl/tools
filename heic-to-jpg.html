<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>HEIC to JPG Converter</title>
  <script src="https://unpkg.com/heic2any@0.0.4/dist/heic2any.min.js"></script>
  <style>
    * {
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      margin: 0;
      padding: 20px;
      background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
      min-height: 100vh;
    }

    .container {
      max-width: 600px;
      margin: 0 auto;
      background: white;
      border-radius: 16px;
      padding: 24px;
      box-shadow: 0 20px 40px rgba(0,0,0,0.1);
    }

    h1 {
      text-align: center;
      color: #333;
      margin-bottom: 8px;
      font-size: 24px;
      font-weight: 600;
    }

    .subtitle {
      text-align: center;
      color: #6b7280;
      margin-bottom: 24px;
      font-size: 14px;
    }

    #dropzone {
      width: 100%;
      min-height: 120px;
      border: 3px dashed #f093fb;
      border-radius: 12px;
      text-align: center;
      padding: 24px;
      margin-bottom: 24px;
      background: linear-gradient(45deg, #fdf2f8, #fce7f3);
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      color: #be185d;
      font-weight: 500;
      font-size: 16px;
    }

    #dropzone:hover {
      border-color: #ec4899;
      background: linear-gradient(45deg, #fce7f3, #fbcfe8);
      transform: translateY(-2px);
    }

    #dropzone.dragover {
      border-color: #db2777;
      background: linear-gradient(45deg, #fbcfe8, #f9a8d4);
      transform: scale(1.02);
    }

    #dropzone .icon {
      font-size: 48px;
      margin-bottom: 12px;
    }

    #dropzone .formats {
      font-size: 12px;
      color: #9ca3af;
      margin-top: 8px;
    }

    #fileInput {
      display: none;
    }

    .controls {
      margin-bottom: 24px;
      display: none;
    }

    .controls.active {
      display: block;
    }

    .control-group {
      margin-bottom: 16px;
    }

    .control-group label {
      display: block;
      margin-bottom: 8px;
      font-weight: 500;
      color: #374151;
    }

    .slider-container {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    #qualityRange {
      flex: 1;
      height: 8px;
      border-radius: 4px;
      background: #e5e7eb;
      outline: none;
      -webkit-appearance: none;
    }

    #qualityRange::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background: linear-gradient(135deg, #f093fb, #f5576c);
      cursor: pointer;
      box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }

    #qualityRange::-moz-range-thumb {
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background: linear-gradient(135deg, #f093fb, #f5576c);
      cursor: pointer;
      border: none;
      box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }

    .quality-value {
      background: linear-gradient(135deg, #f093fb, #f5576c);
      color: white;
      padding: 4px 8px;
      border-radius: 6px;
      font-weight: 600;
      min-width: 40px;
      text-align: center;
    }

    .status-info {
      background: #f3f4f6;
      padding: 12px;
      border-radius: 8px;
      text-align: center;
      font-weight: 500;
      color: #374151;
    }

    .status-info.converting {
      background: #fef3c7;
      color: #92400e;
    }

    .status-info.success {
      background: #d1fae5;
      color: #065f46;
    }

    .status-info.error {
      background: #fee2e2;
      color: #991b1b;
    }

    .preview-container {
      display: none;
      margin-bottom: 20px;
    }

    .preview-container.active {
      display: block;
    }

    #output {
      width: 100%;
      max-width: 100%;
      height: auto;
      border-radius: 12px;
      box-shadow: 0 8px 16px rgba(0,0,0,0.1);
    }

    .filename {
      text-align: center;
      color: #6b7280;
      font-size: 14px;
      margin-top: 8px;
      word-break: break-all;
    }

    .download-btn {
      display: none;
      width: 100%;
      background: linear-gradient(135deg, #f093fb, #f5576c);
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      margin-bottom: 16px;
      transition: all 0.3s ease;
    }

    .download-btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(240, 147, 251, 0.4);
    }

    .download-btn.active {
      display: block;
    }

    .reset-btn {
      display: none;
      width: 100%;
      background: #f3f4f6;
      color: #374151;
      border: 2px solid #e5e7eb;
      padding: 10px 24px;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .reset-btn:hover {
      background: #e5e7eb;
    }

    .reset-btn.active {
      display: block;
    }

    .info-box {
      background: #eff6ff;
      border: 1px solid #bfdbfe;
      border-radius: 8px;
      padding: 12px;
      margin-top: 20px;
      font-size: 13px;
      color: #1e40af;
    }

    .info-box strong {
      display: block;
      margin-bottom: 4px;
    }

    @media (max-width: 480px) {
      body {
        padding: 12px;
      }

      .container {
        padding: 20px;
      }

      h1 {
        font-size: 20px;
      }

      #dropzone {
        min-height: 100px;
        padding: 20px;
        font-size: 14px;
      }

      #dropzone .icon {
        font-size: 36px;
      }

      .slider-container {
        flex-direction: column;
        align-items: stretch;
        gap: 8px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>HEIC to JPG Converter</h1>
    <p class="subtitle">Convert Apple HEIC/HEIF images to JPG format - runs entirely in your browser</p>

    <div id="dropzone">
      <div class="icon">ðŸ“±</div>
      <div>Click or drag and drop HEIC files here</div>
      <div class="formats">Supports .heic and .heif files from iPhone/iPad</div>
    </div>
    <input type="file" id="fileInput" accept=".heic,.heif,image/heic,image/heif">

    <div class="controls" id="controls">
      <div class="control-group">
        <label for="qualityRange">JPG Quality</label>
        <div class="slider-container">
          <input type="range" id="qualityRange" min="10" max="100" value="85" />
          <span class="quality-value" id="qualityValue">85</span>
        </div>
      </div>

      <div class="control-group">
        <div class="status-info" id="statusInfo">Ready to convert</div>
      </div>
    </div>

    <div class="preview-container" id="previewContainer">
      <img id="output" src="" alt="Converted Image" />
      <div class="filename" id="filename"></div>
    </div>

    <button class="download-btn" id="downloadBtn">Download JPG</button>
    <button class="reset-btn" id="resetBtn">Convert Another Image</button>

    <div class="info-box">
      <strong>Privacy First</strong>
      Your images never leave your device. All conversion happens locally in your browser using WebAssembly.
    </div>
  </div>

  <script>
    const dropzone = document.getElementById('dropzone');
    const fileInput = document.getElementById('fileInput');
    const controls = document.getElementById('controls');
    const output = document.getElementById('output');
    const previewContainer = document.getElementById('previewContainer');
    const qualityRange = document.getElementById('qualityRange');
    const qualityValue = document.getElementById('qualityValue');
    const statusInfo = document.getElementById('statusInfo');
    const downloadBtn = document.getElementById('downloadBtn');
    const resetBtn = document.getElementById('resetBtn');
    const filenameDisplay = document.getElementById('filename');

    let convertedBlob = null;
    let originalFilename = '';

    // File input handlers
    dropzone.addEventListener('click', () => {
      fileInput.click();
    });

    fileInput.addEventListener('change', () => {
      const file = fileInput.files[0];
      if (file) {
        processFile(file);
      }
    });

    // Drag and drop handlers
    dropzone.addEventListener('dragover', (e) => {
      e.preventDefault();
      dropzone.classList.add('dragover');
    });

    dropzone.addEventListener('dragleave', () => {
      dropzone.classList.remove('dragover');
    });

    dropzone.addEventListener('drop', (e) => {
      e.preventDefault();
      dropzone.classList.remove('dragover');

      const file = e.dataTransfer.files[0];
      if (file) {
        processFile(file);
      }
    });

    // Quality slider handler
    qualityRange.addEventListener('input', () => {
      qualityValue.textContent = qualityRange.value;
    });

    // Download button handler
    downloadBtn.addEventListener('click', () => {
      if (convertedBlob) {
        const link = document.createElement('a');
        const jpgFilename = originalFilename.replace(/\.(heic|heif)$/i, '') + '.jpg';
        link.download = jpgFilename;
        link.href = URL.createObjectURL(convertedBlob);
        link.click();
        URL.revokeObjectURL(link.href);
      }
    });

    // Reset button handler
    resetBtn.addEventListener('click', () => {
      reset();
    });

    function reset() {
      fileInput.value = '';
      convertedBlob = null;
      originalFilename = '';
      output.src = '';
      controls.classList.remove('active');
      previewContainer.classList.remove('active');
      downloadBtn.classList.remove('active');
      resetBtn.classList.remove('active');
      dropzone.style.display = 'flex';
      statusInfo.className = 'status-info';
      statusInfo.textContent = 'Ready to convert';
    }

    async function processFile(file) {
      const extension = file.name.split('.').pop().toLowerCase();
      if (extension !== 'heic' && extension !== 'heif') {
        setStatus('Please select a HEIC or HEIF file', 'error');
        return;
      }

      originalFilename = file.name;
      dropzone.style.display = 'none';
      controls.classList.add('active');

      setStatus('Converting... This may take a moment for large files', 'converting');

      try {
        const quality = qualityRange.value / 100;

        const convertedBlobs = await heic2any({
          blob: file,
          toType: 'image/jpeg',
          quality: quality
        });

        // heic2any can return a single blob or array of blobs
        convertedBlob = Array.isArray(convertedBlobs) ? convertedBlobs[0] : convertedBlobs;

        const url = URL.createObjectURL(convertedBlob);
        output.src = url;

        // Calculate sizes
        const originalSize = file.size;
        const convertedSize = convertedBlob.size;
        const ratio = ((convertedSize / originalSize) * 100).toFixed(1);

        setStatus(
          `Converted! Original: ${formatBytes(originalSize)} â†’ JPG: ${formatBytes(convertedSize)} (${ratio}%)`,
          'success'
        );

        filenameDisplay.textContent = originalFilename.replace(/\.(heic|heif)$/i, '') + '.jpg';
        previewContainer.classList.add('active');
        downloadBtn.classList.add('active');
        resetBtn.classList.add('active');

      } catch (error) {
        console.error('Conversion error:', error);
        setStatus('Error converting file. Please try another HEIC file.', 'error');
        resetBtn.classList.add('active');
      }
    }

    function setStatus(message, type) {
      statusInfo.textContent = message;
      statusInfo.className = 'status-info ' + (type || '');
    }

    function formatBytes(bytes) {
      if (bytes === 0) return '0 Bytes';
      const k = 1024;
      const sizes = ['Bytes', 'KB', 'MB', 'GB'];
      const i = Math.floor(Math.log(bytes) / Math.log(k));
      return parseFloat((bytes / Math.pow(k, i)).toFixed(1)) + ' ' + sizes[i];
    }
  </script>
</body>
</html>
